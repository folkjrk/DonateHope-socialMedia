'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _server = require('react-dom/server');

var _pug = require('pug');

var _pug2 = _interopRequireDefault(_pug);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (name, pug_path, pug_options, config_path) {
  var output = {
    "name": name
  };

  if (pug_options === undefined) {
    var str = "No options to render \"" + name + "\".";
    throw new Error(str);
  }

  for (var key in pug_options) {
    if (pug_options[key] instanceof Object) {

      if (pug_options[key].path !== undefined) {
        var component_path = _path2.default.resolve(config_path, "..", pug_options[key].path);
        var Component = require(component_path).default;
        if (Component === undefined) Component = require(component_path);
        var props = pug_options[key].props === undefined ? null : pug_options[key].props;

        pug_options[key] = (0, _server.renderToStaticMarkup)(_react2.default.createElement(Component, props));
      }
    }
  }

  if (pug_path === undefined) {
    var html = "";
    for (var _key in pug_options) {
      html += "<div id=\"" + _key + "\">" + pug_options[_key] + "</div>";
    }
    output["html"] = html;
  } else {
    pug_path = _path2.default.resolve(config_path, "..", pug_path);
    var _html = _pug2.default.renderFile(pug_path, pug_options);
    output["html"] = _html;
  }

  return output;
};